"use strict";(globalThis.webpackChunkblog2=globalThis.webpackChunkblog2||[]).push([[5665],{26195(e,a,t){t.r(a),t.d(a,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>c,metadata:()=>n,toc:()=>i});var n=t(91780),s=t(62615),h=t(10253);const c={title:"Cache busting GET calls with cache-control headers",tags:["frontend"],date:new Date("2020-12-09T07:58:41.000Z"),authors:["dhbalaji"]},r=void 0,o={authorsImageUrls:[void 0]},i=[{value:"What is cache in programming &amp; a little bit about related jargon",id:"what-is-cache-in-programming--a-little-bit-about-related-jargon",level:2},{value:"Cache-Control header? What&#39;s that?",id:"cache-control-header-whats-that",level:2},{value:"How to bust browser GET calls cache?",id:"how-to-bust-browser-get-calls-cache",level:2},{value:"How to cache bust API Calls generated from code?",id:"how-to-cache-bust-api-calls-generated-from-code",level:2},{value:"What are the header options to no cache?",id:"what-are-the-header-options-to-no-cache",level:2},{value:"What if we want to validate the cache with the server each time?",id:"what-if-we-want-to-validate-the-cache-with-the-server-each-time",level:2},{value:"How do I prevent a cache from stored in public caches",id:"how-do-i-prevent-a-cache-from-stored-in-public-caches",level:2},{value:"What if I want my cache to expire in one day",id:"what-if-i-want-my-cache-to-expire-in-one-day",level:2},{value:"What if I want my cache to be private, validated each time",id:"what-if-i-want-my-cache-to-be-private-validated-each-time",level:2},{value:"What&#39;s the browser support",id:"whats-the-browser-support",level:2},{value:"Can we classify the data in the cache",id:"can-we-classify-the-data-in-the-cache",level:2},{value:"How much cache can we store in the browser",id:"how-much-cache-can-we-store-in-the-browser",level:2},{value:"How does this conditional validation of cache work",id:"how-does-this-conditional-validation-of-cache-work",level:2},{value:"If header values are comma-separated, what&#39;s the precedence",id:"if-header-values-are-comma-separated-whats-the-precedence",level:2},{value:"Why does one prefer to use cache",id:"why-does-one-prefer-to-use-cache",level:2}];function l(e){const a={blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,h.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.p,{children:(0,s.jsx)(a.img,{alt:"cache calls",src:t(62891).A+"",width:"1280",height:"853"})}),"\n",(0,s.jsx)(a.p,{children:"One of the performance optimization techniques is to serve data from the cache and lookup for the network if the cache fails. It's called cache first then network strategy. Life moves fast and if the API has to get updated information, it's impossible because we are reading the cache always. Is there a way to bypass cache in this setup? Yes, it's cache-control headers."}),"\n",(0,s.jsx)(a.h2,{id:"what-is-cache-in-programming--a-little-bit-about-related-jargon",children:"What is cache in programming & a little bit about related jargon"}),"\n",(0,s.jsx)(a.p,{children:"The cache is similar to duplicating a response to use serve the response when required. The cache may be used as-is or after validating for changes from the server."}),"\n",(0,s.jsxs)(a.p,{children:["The place where we store the cache is called ",(0,s.jsx)(a.code,{children:"store"}),"."]}),"\n",(0,s.jsx)(a.p,{children:"Caching about the frontend can happen in the browser, on the server-side, or at the CDN level, we can have caches."}),"\n",(0,s.jsx)(a.p,{children:"The cache is beneficial only when managed correctly, when it reaches a stage it's unmanageable then it will be a problem. A cache should serve the local data only as long as the data at the source has not changed otherwise the user might see old data."}),"\n",(0,s.jsx)(a.p,{children:"There are 2 types of cache. The private cache is like a private car. To be used by one client. The other variant is the shared cache. The shared cache could be caching the home page on the server which will be served to multiple users."}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"HTTP caching is applicable for GET calls & it cannot be applied for other HTTP methods. the URL becomes the key in the cache"}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"cache-control-header-whats-that",children:"Cache-Control header? What's that?"}),"\n",(0,s.jsxs)(a.p,{children:["Now that we know the cache & its types. We need a control mechanism for the cache. Its provided by the ",(0,s.jsx)(a.code,{children:"Cache-Control"})," header."]}),"\n",(0,s.jsx)(a.p,{children:"Before we take more about it, the reader should know what is a header. The header is present in both the request and the response. In the request, it's called the request header. On the response, it's called the response header. The request header can be modified by JS code in the browser."}),"\n",(0,s.jsx)(a.h2,{id:"how-to-bust-browser-get-calls-cache",children:"How to bust browser GET calls cache?"}),"\n",(0,s.jsx)(a.p,{children:"The old school way is to ensure the GET call URL looks different or is different."}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"In webpack we have the hashing of build files so that the URLs are reaching the server to get the new files after the new build."}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["In ",(0,s.jsx)(a.code,{children:"REST"})," get calls the query param is changed so that the browser thinks it's a new request and bypasses cache. For instance, using ",(0,s.jsx)(a.code,{children:"Date.now()"})," as the query hash. The common versioning by API number is a commonly accepted syntax."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"In the case of browser get calls we cannot do header change to do cache busting, we have to fallback to generate unique URLs."}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"how-to-cache-bust-api-calls-generated-from-code",children:"How to cache bust API Calls generated from code?"}),"\n",(0,s.jsxs)(a.p,{children:["If you use a package like ",(0,s.jsx)(a.code,{children:"axios"})," or any other to generate GET calls, we have the API to generate request headers for the API calls dynamically."]}),"\n",(0,s.jsxs)(a.p,{children:["For instance, we can set the header to cache bust when the user clicks on the ",(0,s.jsx)(a.code,{children:"refresh"})," button else get the response from ",(0,s.jsx)(a.code,{children:"cache"}),"."]}),"\n",(0,s.jsx)(a.h2,{id:"what-are-the-header-options-to-no-cache",children:"What are the header options to no cache?"}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"Technically we want to instruct the browser not to store the GET call in the cache. We call it no-store"}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["We can use ",(0,s.jsx)(a.code,{children:"Cache-Control: no-store"}),". The request and the response will not be stored. If an existing cache exists, it will be ignored. If you have a request header with ",(0,s.jsx)(a.code,{children:"no-cache"}),", the request is sent to the server and the full response will be downloaded."]}),"\n",(0,s.jsx)(a.h2,{id:"what-if-we-want-to-validate-the-cache-with-the-server-each-time",children:"What if we want to validate the cache with the server each time?"}),"\n",(0,s.jsxs)(a.p,{children:["We want to serve fresh data as much as possible at the same time use cache if possible. So we use ",(0,s.jsx)(a.code,{children:"no-cache"}),". Though it sounds confusing at first. ",(0,s.jsx)(a.code,{children:"no-cache"})," is about checking correctness with the server before using the cache."]}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"no-cache should technically be called cached but validate each time"}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"how-do-i-prevent-a-cache-from-stored-in-public-caches",children:"How do I prevent a cache from stored in public caches"}),"\n",(0,s.jsx)(a.p,{children:"We can enforce rules to cache. For instance, I do not want my bank GET calls to be cached by my ISP. In that case, the developers need to use"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"Cache-Control: private"})}),"\n",(0,s.jsx)(a.p,{children:"To recap, private means cache for one user. Public means the request can be cached and served for multiple users."}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"Cache-Control: public"})}),"\n",(0,s.jsx)(a.h2,{id:"what-if-i-want-my-cache-to-expire-in-one-day",children:"What if I want my cache to expire in one day"}),"\n",(0,s.jsxs)(a.p,{children:["We have ",(0,s.jsx)(a.code,{children:"max-age"})," which takes time value in seconds. If you set the max-age to 3600 seconds. Then the cache is considered for one hour since the request has been initiated."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"Cache-Control: max-age=3600"})}),"\n",(0,s.jsx)(a.h2,{id:"what-if-i-want-my-cache-to-be-private-validated-each-time",children:"What if I want my cache to be private, validated each time"}),"\n",(0,s.jsxs)(a.p,{children:["We can separate the values for ",(0,s.jsx)(a.code,{children:"Cache-Control"})," by a comma."]}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"Cache-Control: private, max-age=3600"})}),"\n",(0,s.jsx)(a.h2,{id:"whats-the-browser-support",children:"What's the browser support"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:"Cache-Control"})," was introduced in HTTP 1.1. For backward compatibility, we can use the ",(0,s.jsx)(a.code,{children:"pragma"})," header."]}),"\n",(0,s.jsx)(a.h2,{id:"can-we-classify-the-data-in-the-cache",children:"Can we classify the data in the cache"}),"\n",(0,s.jsx)(a.p,{children:"The cache data can be classified as"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Fresh - means its relevant and data has not reached expiry date"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Stale - it's past the expiry date set by the max-age"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"how-much-cache-can-we-store-in-the-browser",children:"How much cache can we store in the browser"}),"\n",(0,s.jsx)(a.p,{children:"There are a few things about cache"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Cache is dependent on the resources"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Not all of my cache will be stored on my browser forever. The cache works in LIFO format. Let's say I have a cache key that was not used for a long time. It might get dropped when there is a resource constraint. Technically we call it ",(0,s.jsx)(a.code,{children:"cache eviction"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"how-does-this-conditional-validation-of-cache-work",children:"How does this conditional validation of cache work"}),"\n",(0,s.jsx)(a.p,{children:"We can trigger a conditional request. Think of it like a ternary operator in JS."}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"const isIndian = hasAadharCard ? true : false; // lol"})}),"\n",(0,s.jsxs)(a.p,{children:["In the above example, based on the ",(0,s.jsx)(a.code,{children:"hasAadharCard"})," value. We are assigned a boolean to ",(0,s.jsx)(a.code,{children:"isIndian"}),"."]}),"\n",(0,s.jsxs)(a.p,{children:["If the request header has an ",(0,s.jsx)(a.code,{children:"If-None-Match"})," header, then we are triggering a special variant of HTTP call which will get"]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Full response downloaded when the data has changed on the server. This call is similar to the GET call getting a status code of 200. This change is based on a comparison of the ",(0,s.jsx)(a.code,{children:"ETag"})," code."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["No response when the data has not changed on the server. This call gets an empty response because the cache is going to be released in the place of response by the browser. The status code is ",(0,s.jsx)(a.code,{children:"304"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"behind the scenes, we send an extra header"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:'If-none-match: "329772378483289832989328932893298ndo28938293"'})," the code is the ",(0,s.jsx)(a.code,{children:"ETag"})," code which is sent as part of response header. ETag is like the version number for your cache. If the version number (etag code) matches, then the cache version is used"]}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"When the ETag codes are the same, then we can sure that the cached content is the same byte for byte so we can use the cache on the browser in place of response. That's why the server sends a 304 status code."}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["Sometimes browsers are smart enough to cache data and compare it with the server without the developer writing any code for caching functionality. But it's unreliable so it'\ns better to take better control by setting ",(0,s.jsx)(a.code,{children:"Cache-Control"})," headers."]}),"\n",(0,s.jsx)(a.h2,{id:"if-header-values-are-comma-separated-whats-the-precedence",children:"If header values are comma-separated, what's the precedence"}),"\n",(0,s.jsx)(a.p,{children:"Here are a couple of things to know"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Some combination of header values makes it invalid"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["If you have max-age and the value is valid. Let's say you set the cache age to 1 year. The data is considered fresh for a whole one year and the data validation does not occur. Unless you have ",(0,s.jsx)(a.code,{children:"no-cache"})," mentioned."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"why-does-one-prefer-to-use-cache",children:"Why does one prefer to use cache"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"It's for performance reasons. The benefits are manifold"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If the server returns 304, then the transmission of data over wire is reduced. It's a performance gain."}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If an asset is a cache for some time. The subsequent API calls are returned from disk instead of the server. That's a huge performance gain."}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Caching content on the server can be served to multiple users. This is called the public cache."}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:a}={...(0,h.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},62891(e,a,t){t.d(a,{A:()=>n});const n=t.p+"assets/images/cachecalls-71b6e4b4ae9f3d378584be651895d7d2.webp"},10253(e,a,t){t.d(a,{R:()=>c,x:()=>r});var n=t(59471);const s={},h=n.createContext(s);function c(e){const a=n.useContext(h);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(h.Provider,{value:a},e.children)}},91780(e){e.exports=JSON.parse('{"permalink":"/blog/Cache-busting-get-calls-with-cache-control-headers","source":"@site/blog/Cache-busting-get-calls-with-cache-control-headers.md","title":"Cache busting GET calls with cache-control headers","description":"cache calls","date":"2020-12-09T07:58:41.000Z","tags":[{"inline":true,"label":"frontend","permalink":"/blog/tags/frontend"}],"readingTime":6.75,"hasTruncateMarker":true,"authors":[{"name":"D Balaji","title":"Lead Design Technologist","url":"https://github.com/dhbalaji","imageURL":"https://avatars.githubusercontent.com/u/3672491?v=4","key":"dhbalaji","page":null}],"frontMatter":{"title":"Cache busting GET calls with cache-control headers","tags":["frontend"],"date":"2020-12-09T07:58:41.000Z","authors":["dhbalaji"]},"unlisted":false,"prevItem":{"title":"WFH vs Remote working & the WFH allowance analysis","permalink":"/blog/WFH-vs-Remote-working"},"nextItem":{"title":"Understanding google data storage options in GCP","permalink":"/blog/Understanding-google-data-storage-options-in-GCP"}}')}}]);